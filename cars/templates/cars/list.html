{% extends "cars/base.html" %}
{% block title %}Cars — AutoHub{% endblock %}

{% block hero %}
<div class="hero">
  <div class="container">
    <div class="row align-items-center">
      <div class="col-md-8">
        <h1 class="display-6">Find your next car</h1>
        <p class="lead">Browse the latest arrivals — filter by make, year, price and more.</p>
      </div>
      <div class="col-md-4 text-md-end">
        <a class="btn btn-primary btn-lg" href="{% url 'cars:contact' %}">Contact Dealer</a>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block content %}
<div class="row">
  <div class="col-md-3 mb-4">
    <div class="card filter-card p-3">
      <form method="get" class="mb-0">
        <div class="mb-2">
          <label class="form-label">Make</label>
          <input name="make" value="{{ request.GET.make }}" class="form-control" list="makes-list" placeholder="e.g. Toyota">
          <datalist id="makes-list">
            {% for m in makes %}
              <option value="{{ m }}">{{ m }}</option>
            {% endfor %}
          </datalist>
        </div>
        <div class="mb-2">
          <label class="form-label">Min Year</label>
          <input name="min_year" value="{{ request.GET.min_year }}" class="form-control" type="number" min="1900" max="2100">
        </div>
        <div class="mb-2">
          <label class="form-label">Max Price (₦)</label>
          <input name="max_price" value="{{ request.GET.max_price }}" class="form-control" type="number">
        </div>
        <div class="d-flex gap-2">
          <button class="btn btn-primary w-100" type="submit">Apply</button>
          <a class="btn btn-outline-secondary" href="{% url 'cars:list' %}">Reset</a>
        </div>
      </form>
    </div>
  </div>

  <div class="col-md-9">
    <div class="row g-3">
      {% for car in cars %}
      <div class="col-md-6 col-lg-4">
        <div class="card car-card h-100">
          {% with car.images.all|first as first_img %}
            {% if first_img %}
              <img src="{{ first_img.image.url }}" class="card-img-top" alt="{{ car.title }}">
            {% else %}
              <img src="https://via.placeholder.com/800x450?text=No+image" class="card-img-top" alt="no-image">
            {% endif %}
          {% endwith %}
          <div class="card-body d-flex flex-column">
            <h5 class="card-title"><a href="{% url 'cars:detail' car.slug %}">{{ car.title }}</a></h5>
            <p class="card-text small text-muted mb-2">{{ car.make }} — {{ car.model }} — {{ car.year }}</p>
            <p class="card-text mb-3">{{ car.description|truncatewords:25 }}</p>
            <div class="mt-auto d-flex justify-content-between align-items-center">
              <div class="price-badge">₦{{ car.price }}</div>
             <a href="{% url 'cars:detail' car.slug %}" class="btn btn-warning btn-sm w-100">View Details</a>
            </div>
          </div>
        </div>
      </div>
      {% empty %}
        <p class="text-muted">No cars match your search.</p>
      {% endfor %}
    </div>
  </div>
</div>
{% endblock %}
